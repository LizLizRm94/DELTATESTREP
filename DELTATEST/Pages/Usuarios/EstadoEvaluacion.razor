@page "/estado/{IdUsuario:int}"
@using DELTATEST.Models
@using DELTATEST.Services
@layout MainSinLayout
@inject NavigationManager NavigationManager
@inject EvaluadoService EvaluadoService

@if (estado == null)
{
    <p>Cargando estado del usuario...</p>
}
else
{
    <div class="d-flex justify-content-end mb-2">
        <p class="text-muted fw-semibold">Hola, @estado.NombreCompleto</p>
    </div>

    <h2 class="text-center text-orange text-uppercase mb-4">Mi estado de evaluación</h2>

    <div class="row">
        <div class="col-md-6 d-flex flex-column align-items-center">
            <div class="d-flex flex-column align-items-center w-100" style="max-width: 420px;">
                <div class="card shadow-sm border-0 card-orange text-center p-4 mb-3 w-100">
                    <h5 class="card-title text-orange">Promedio General</h5>
                    <p class="display-6 fw-bold text-orange">@estado.PromedioGeneral / 100</p>
                </div>
                <div class="card shadow-sm border-0 card-orange text-center p-3 mb-3 w-100">
                    <h5 class="card-title text-orange mb-1">Puesto Actual</h5>
                    <p class="fs-5 fw-semibold">@estado.PuestoActual</p>
                </div>
                <button class="btn btn-orange mt-1" @onclick="VerEvaluaciones">
                    Ver Evaluaciones
                </button>
            </div>
        </div>

        <!-- DERECHA: NOTIFICACIONES -->
        <div class="col-md-6">
            <h4 class="mb-3 text-orange text-center">Notificaciones</h4>
            @if (estado.Notificaciones.Any())
            {
                <ul class="list-group">
                    @foreach (var n in estado.Notificaciones)
                    {
                        <li class="list-group-item">
                            <strong>@n.TipoNotificacion:</strong> @n.Mensaje
                            <div class="small text-muted">
                                @(n.FechaEnvio?.ToString("dd/MM/yyyy HH:mm"))
                            </div>
                        </li>
                    }
                </ul>
            }
            else
            {
                <div class="alert alert-info text-center">No tienes notificaciones nuevas.</div>
            }
        </div>
    </div>
}

@code {
    [Parameter] public int IdUsuario { get; set; }
    private EvaluadoEstado? estado;

    protected override async Task OnInitializedAsync()
    {
        estado = await EvaluadoService.ObtenerEstadoAsync(IdUsuario);
    }

    private void VerEvaluaciones()
    {
        NavigationManager.NavigateTo($"/usuarios/evaluaciones/{IdUsuario}");
    }
}
